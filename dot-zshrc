EMACS_INFO="/Applications/Emacs.app/Contents/Resources/info"
EMACS_BIN="/Applications/Emacs.app/Contents/MacOS/bin"
export INFOPATH=$EMACS_INFO:/usr/local/info:/usr/local/share/info:$INFOPATH
export SVN_EDITOR=emacsclient
export EDITOR='mg -f auto-fill-mode'
export JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home
# don't let tar, etc copy Finder specific junk.
export COPY_EXTENDED_ATTRIBUTES_DISABLE=true
#export COPYFILE_DISABLE=true

typeset -U path
path=(
    ~/bin
    /usr/local/bin
    /usr/local/sbin
    /usr/local/share/python
    /usr/local/Cellar/python/2.7.2/bin
    /usr/local/texlive/2007/bin/i386-darwin
    /usr/texbin
    ${JAVA_HOME}/bin
    $EMACS_BIN
    $path
)

## rvm
[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm"

for f in ${HOME}/.zsh/lib/*; source $f

cdpath=( . ~/oc ~/src ~/Notebook ~/Dropbox )

chpwd() {
    [[ -t 1 ]] || return
    case $TERM in
      sun-cmd) print -Pn "\e]l%~\e\\"
        ;;
      *xterm*|rxvt|(dt|k|E)term) print -Pn "\e]2;%3~\a"
        ;;
    esac
}
chpwd

bindkey -e

zmodload -i zsh/complist
bindkey -M menuselect '^o' accept-and-infer-next-history
bindkey '^?' backward-delete-char
#
#---


#--- zsh options ---
#
setopt autopushd cdablevars autocd extendedglob histignorealldups 
setopt appendhistory extendedhistory histsavenodups pushdignoredups
setopt histfindnodups combiningchars
unsetopt beep nomatch

#--- Shell Functions ---
#
fpath+=(
  ${HOME}/.zsh/functions
)
export GEMDIR=$(gem environment | grep -A1 'GEM PATHS' | tail -1 | awk '{print $2}')
autoload ${HOME}/.zsh/functions/*(:t)

#--- load the completion stuff
. ${HOME}/.zshcomp
for f in ${HOME}/.zsh/bash_completion.d/*; source $f
source /usr/local/etc/bash_completion.d/git-completion.bash

#--- Fix for emacs key binding
WORDCHARS=${WORDCHARS//[\/]}

#--- Git prompt setup
autoload -Uz vcs_info

autoload colors
colors

precmd() {
  psvar=()
  vcs_info
  [[ -n $vcs_info_msg_0_ ]] && psvar[1]="$vcs_info_msg_0_"
}

PROMPT='[%m] %2~: '
RPROMPT="%(1v.%{$fg[yellow]%}%1v%f.)%{$reset_color%}"

# keychain stuff for ssh agent
/usr/local/bin/keychain -Q -q opscode-platform-20100217 \
                              opscode-preprod-20101208 \
                              sfalcon.priv \
                              opscode_github_sf
[[ -f ~/.keychain/$HOST-sh ]] && . "$HOME/.keychain/$HOST-sh"

ulimit -n 1024

